<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ä»˜éŒ¢å°éŠæˆ²</title>
<style>
@font-face{
  font-family:"BpmfZihiKaiStd-Regular";
  src: local("BpmfZihiKaiStd-Regular");
}
body{
  margin:0;
  font-family:"BpmfZihiKaiStd-Regular", sans-serif;
  background:#f2f2f2;
  overflow:hidden;
}
/* ===== æç¤ºé  ===== */
#intro{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.slide{
  position:relative;
  width:485px;
  height:80%;
  background:#97CBFF;
  border-radius:20px;
  padding:60px 50px;
  box-sizing:border-box;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.slide h1{
  font-size:36px;
  margin:0;
  text-align:center;
}
.slideContentLeft{
  text-align:left;
  margin:auto 0;
  font-size:20px;
  line-height:1.9;
}

/* ===== èªªæ˜é åœ–ç‰‡ ===== */
.slideContentLeft img{
  display:block;
  margin:0 auto 20px auto;  /* ç½®ä¸­ + ä¸‹æ–¹ç•™è· */
  max-width:100%;           /* ä¸è¶…å‡ºå¯¬åº¦ */
  max-height:250px;         /* æ§åˆ¶é«˜åº¦ */
  height:auto;
}

.navBtn{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  font-size:26px;
  padding:12px 18px;
  border-radius:50%;
  background:white;
  border:none;
  cursor:pointer;
  font-family:"BpmfZihiKaiStd-Regular";
  display:flex;
  align-items:center;
  justify-content:center;
}
#prevBtn{left:-35px;}
#nextBtn{right:-35px;}
#startBtn{
  display:none;
  background:#0066CC;
  color:white;
  font-size:22px;
  padding:12px 30px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  position:absolute;
  bottom:30px;      
  left:50%;
  transform:translateX(-50%);
  font-family:"BpmfZihiKaiStd-Regular";
}
/* ===== éŠæˆ²ç‰ˆé¢ ===== */
#game{height:100vh;box-sizing:border-box;}
#top{display:flex;height:80vh;}
#left{
  flex:2;
  display:flex;
  align-items:center;      
  justify-content:center;  
  position:relative;
  background:#ffffff;
}
#right{
  flex:1;
  display:flex;
  flex-direction:column;
  background:#e6f4ff;
}
#product{
  width:500px;
  height:500px;
  display:flex;
  align-items:center;
  justify-content:center;
}
#product img{
  width:500px;
  height:500px;
}
#priceTag{
  position:absolute;
  bottom:10px;  
  right:10px;   
  background:#97CBFF;
  padding:12px 22px;
  border-radius:14px;
  font-size:34px;
}
#sumArea{
  height:25%;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  font-size:30px;
  background:#cfe8ff;
}
#eyeBtn{
  position:absolute;
  right:15px;
  bottom:15px;
  cursor:pointer;
}
#payZone{
  height:75%;
  border:3px dashed #666;
  border-radius:20px;
  margin:10px;
  padding:10px;
  position:relative;
  background:#ffffff;
}
#payZone::before {
  content: "ä»˜éŒ¢å€";
  position: absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  font-family:"BpmfZihiKaiStd-Regular";
  color:#cccccc;
  font-size:24px;
  pointer-events:none;
  z-index:0;
}
#coins{
  height:20vh;
  background:#d9d9d9;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 60px;
  box-sizing:border-box;
}
.coin{
  border:3px solid #333;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  user-select:none;
  font-weight:bold;
  position:relative;
  font-family:"BpmfZihiKaiStd-Regular";
}
.coin[data-value="1000"]{width:110px;height:60px;background:#ABDBED;border-radius:12px;}
.coin[data-value="100"]{width:95px;height:60px;background:#EDABAB;border-radius:12px;}
.coin[data-value="10"]{width:60px;height:60px;background:#D7D4CB;border-radius:50%;}
.coin[data-value="1"]{width:45px;height:45px;background:#D6B880;border-radius:50%;}
#historyBtn{
  background:#97CBFF;
  font-size:24px;
  padding:14px 28px;
  border-radius:14px;
  border:none;
  cursor:pointer;
  font-family:"BpmfZihiKaiStd-Regular";
}
/* ===== æ­·å²è¦–çª— ===== */
#modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:100;
}
.modalContent{
  width:485px;
  height:80%;
  background:#97CBFF;
  border-radius:20px;
  padding:40px;
  box-sizing:border-box;
  text-align:center;
  overflow:auto;
}
.historyBlock{
  margin:20px 0;
}
.historyCoins{
  display:flex;
  gap:10px;
  justify-content:center;  /* æ•´é«”ç½®ä¸­ */
  align-items:flex-end;    /* åº•éƒ¨å°é½Š */
  flex-wrap:wrap;
}

.historyCoins .coinWrapper{
  display:flex;
  align-items:flex-end;  /* coin èˆ‡ times åº•éƒ¨å°é½Š */
  margin-right:8px;
}
.historyCoins .coin{
  width:auto; height:auto;
  padding:10px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  margin-bottom:0;  /* å–æ¶ˆåº•éƒ¨é–“è· */
}
.historyCoins .coin[data-value="1"] {
  width:30px;
  height:30px;
  border-radius:50%;
  padding:0;
  font-size:16px;
}
.historyCoins .times{
  margin-left:4px;
  font-size:18px;
  align-self:flex-end;
}
.historyTitle{
  font-size:22px;
  margin-bottom:10px;
}
</style>
</head>
<body>

<div id="game">
  <div id="top">
    <div id="left">
      <div id="product">
        <img src="product.png" alt="å•†å“åœ–ç‰‡">
      </div>
      <div id="priceTag">3512å…ƒ</div>
    </div>
    <div id="right">
      <div id="sumArea">
        <span id="sumText">ï¼Šï¼Šï¼Šï¼Š</span>
        <span id="eyeBtn">ğŸ‘</span>
      </div>
      <div id="payZone"></div>
    </div>
  </div>
  <div id="coins">
    <div style="display:flex;gap:40px;align-items:center;">
      <div class="coin" data-value="1000">1000</div>
      <div class="coin" data-value="100">100</div>
      <div class="coin" data-value="10">10</div>
      <div class="coin" data-value="1">1</div>
    </div>
    <button id="historyBtn">éå»ä»˜æ¬¾æ–¹å¼</button>
  </div>
</div>

<div id="intro">
  <div class="slide">
    <button id="prevBtn" class="navBtn" onclick="prevSlide()"><</button>
    <button id="nextBtn" class="navBtn" onclick="nextSlide()">></button>
    <div id="slideContent"></div>
    <button id="startBtn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
  </div>
</div>

<div id="modal"><div class="modalContent" id="modalContent"></div></div>

<script>
const PRICE=3512;
const REQUIRED_WAYS=3;
let currentSum=0;
let history=[];
let showSum=false;

// ===== éŸ³æ•ˆ =====
const coinPlaceSound = new Audio('coinPlace.mp3');   
const coinRemoveSound = new Audio('coinRemove.mp3'); 
const successNewSound = new Audio('successNew.mp3');
const successRepeatSound = new Audio('successRepeat.mp3');
const successAllSound = new Audio('successAll.mp3');
const btnClickSound = new Audio('btnClick.mp3');

/* ===== æç¤ºé  ===== */
const slides=[
`<h1>ä»˜éŒ¢å°éŠæˆ²</h1>
<div class="slideContentLeft">
  <p>æˆ‘å€‘åœ¨è²·æ±è¥¿ó ‡¡æ™‚ï¼Œå¯ä»¥ç”¨ä¸ä¸€ó ‡¡æ¨£çš„éŒ¢å¹£çµ„åˆä¾†ä»˜éŒ¢ã€‚</p>
  <p>åƒ10å¡ŠéŒ¢å°±å¯ä»¥ä»˜1å€‹ó ‡¡10å¡Šï¼Œæˆ–10å€‹ó ‡¡1å¡Šã€‚</p>
  <p>æ¥ä¸‹ä¾†è«‹è©¦è©¦çœ‹ç”¨ä¸åŒçš„3ç¨®æ–¹å¼ä¾†ä»˜éŒ¢å§ï¼</p>
</div>`,
`<div class="slideContentLeft">
  <img src="intro2.png" alt="èªªæ˜åœ–ç‰‡2">
  <p>åœ¨éŠæˆ²ç•«é¢ä¸­é–“æœƒæœ‰ä¸€ó ‡¡æ¨£å•†å“ã€‚</p>
  <p>åœ¨å•†å“å³ä¸‹è§’çš„è—è‰²æ¡†è£¡ï¼Œæ˜¯ä½ è¦æ”¯ä»˜çš„åƒ¹éŒ¢ã€‚</p>
</div>`,
`<div class="slideContentLeft">
  <img src="intro3.png" alt="èªªæ˜åœ–ç‰‡3">
  <p>åœ¨éŠæˆ²ç•«é¢çš„ä¸‹æ–¹æœ‰1000å…ƒã€100å…ƒã€10å…ƒèˆ‡1å…ƒã€‚</p>
  <p>è«‹é•·æŒ‰éŒ¢å¹£ä¾†ç§»å‹•å®ƒå€‘åˆ°ä»˜éŒ¢å€ä¾†æ”¯ä»˜ã€‚</p>
</div>`,
`<div class="slideContentLeft">
  <img src="intro4.png" alt="èªªæ˜åœ–ç‰‡4">
  <p>å¦‚æœä¸å°å¿ƒæ”¾éŒ¯éŒ¢å¹£ï¼Œé»ä¸€ó ‡¡ä¸‹åœ¨ä»˜éŒ¢å€çš„éŒ¢å¹£å°±å¯ä»¥ç§»é™¤ã€‚</p>
</div>`,
`<div class="slideContentLeft">
  <img src="intro5.png" alt="éå»ä»˜æ¬¾æ–¹å¼åœ–ç‰‡">
  <p>åœ¨ä»˜éŒ¢å€ä¸‹æ–¹çš„ã€Œéå»ä»˜æ¬¾æ–¹å¼ã€æŒ‰éˆ•ï¼Œå¯ä»¥è®“ä½ çœ‹åˆ°ç”¨éçš„ä»˜éŒ¢æ–¹å¼ã€‚</p>
</div>`,
`<div class="slideContentLeft">
  <img src="intro6.png" alt="èªªæ˜åœ–ç‰‡5">
  <p>åœ¨ä»˜éŒ¢å€ä¸Šæ–¹ï¼Œæœƒæ˜¯ä½ å·²ç¶“æ”¯ä»˜çš„é‡‘é¡ã€‚</p>
  <p>æŒ‰å³ä¸‹è§’çš„çœ¼ç›å°±å¯ä»¥æŸ¥çœ‹ä½ æ”¯ä»˜çš„ç¸½é‡‘é¡ã€‚</p>
</div>`,
`<div class="slideContentLeft"><p>ç•¶æ”¯ä»˜çš„é‡‘é¡å‰›å¥½æ™‚ï¼Œå°±æœƒè‡ªå‹•å®Œæˆ1ç¨®ä»˜æ¬¾æ–¹å¼ã€‚</p><p>ä½ ç¸½å…±éœ€è¦å®Œæˆ3ç¨®ä¸åŒæ–¹å¼å–”ï¼</p><p>ä¸€ó ‡¢èµ·ä¾†è©¦è©¦çœ‹å§ï¼</piv></div>`
];
let currentSlide=0;
function renderSlide(){
  document.getElementById('slideContent').innerHTML=slides[currentSlide];
  document.getElementById('prevBtn').style.display=currentSlide===0?'none':'block';
  document.getElementById('nextBtn').style.display=currentSlide===slides.length-1?'none':'block';
  document.getElementById('startBtn').style.display=currentSlide===slides.length-1?'block':'none';
}
function nextSlide(){if(currentSlide<slides.length-1){currentSlide++;renderSlide();}}
function prevSlide(){if(currentSlide>0){currentSlide--;renderSlide();}}
function startGame(){
  btnClickSound.currentTime=0;
  btnClickSound.play();
  document.getElementById('intro').style.display='none';
}
renderSlide();

/* ===== é‡‘é¡ ===== */
function updateSum(){document.getElementById('sumText').textContent=showSum?currentSum+'å…ƒ':'ï¼Šï¼Šï¼Šï¼Š';}
document.getElementById('eyeBtn').onclick=function(){showSum=!showSum;updateSum();};
updateSum();

/* ===== æ‹–æ›³ ===== */
document.querySelectorAll('.coin').forEach(c=>c.addEventListener('mousedown',startDrag));
function startDrag(e){
  const value=Number(e.target.dataset.value);
  const clone=e.target.cloneNode(true);
  clone.style.position='absolute';
  clone.style.zIndex=1000;
  document.body.appendChild(clone);
  move(e.clientX,e.clientY);
  function move(x,y){clone.style.left=x-clone.offsetWidth/2+'px';clone.style.top=y-clone.offsetHeight/2+'px';}
  function onMove(ev){move(ev.clientX,ev.clientY);}  
  document.addEventListener('mousemove',onMove);
  document.addEventListener('mouseup',function up(ev){
    document.removeEventListener('mousemove',onMove);
    document.removeEventListener('mouseup',up);
    const rect=payZone.getBoundingClientRect();
    if(ev.clientX>rect.left&&ev.clientX<rect.right&&ev.clientY>rect.top&&ev.clientY<rect.bottom){
      clone.style.position='absolute';
      clone.style.left=(ev.clientX-rect.left-30)+'px';
      clone.style.top=(ev.clientY-rect.top-30)+'px';
      payZone.appendChild(clone);

      coinPlaceSound.currentTime = 0;
      coinPlaceSound.play();

      currentSum+=value;
      updateSum();
      clone.onclick=function(){
        currentSum-=value;
        updateSum();
        coinRemoveSound.currentTime = 0;
        coinRemoveSound.play();
        clone.remove();
        // æª¢æŸ¥æ‰£æ‰å¾Œæ˜¯å¦å‰›å¥½
        checkPayment();
      };
      checkPayment();
    }else clone.remove();
  });
}

/* ===== åˆ¤å®š ===== */
function checkPayment(){
  if(currentSum!==PRICE) return;
  const values=[...payZone.children].map(c=>Number(c.dataset.value));
  const recordObj={1000:0,100:0,10:0,1:0};
  values.forEach(v=>recordObj[v]++);
  const recordKey=JSON.stringify(recordObj);

  if(history.includes(recordKey)){
    showMessage(`ä½ å‰›å‰›å·²ç¶“ä½¿ç”¨éé€™ç¨®æ–¹å¼äº†ã€‚<br>æ›ä¸€ó ‡¢ç¨®æ”¯ä»˜æ–¹æ³•è©¦è©¦å§ï¼<br>é‚„éœ€è¦å˜—è©¦${REQUIRED_WAYS-history.length}ç¨®ä»˜éŒ¢æ–¹å¼å–”ï¼`,false);
    successRepeatSound.currentTime=0;
    successRepeatSound.play();
  }else{
    history.push(recordKey);
    if(history.length<REQUIRED_WAYS){
      showMessage(`ä½ å·²å®Œæˆ${history.length}ç¨®æ”¯ä»˜æ–¹å¼ï¼Œ<br>é‚„è¦å˜—è©¦ç”¨${REQUIRED_WAYS-history.length}ç¨®æ–¹å¼ä¾†ä»˜éŒ¢ã€‚`,false);
      successNewSound.currentTime=0;
      successNewSound.play();
    }else{
      showMessage(`æ­å–œä½ å·²ç¶“ç”¨äº†3ç¨®ä¸åŒçš„æ–¹å¼ä¾†å®Œæˆæ”¯ä»˜ï¼<br><br>åŒæ¨£çš„é‡‘é¡å¯ä»¥æœ‰å¾ˆå¤šä¸åŒçš„ä»˜æ¬¾æ–¹å¼ã€‚<br>æ¥ä¸‹ä¾†æˆ‘å€‘å†ç¹¼çºŒç·´ç¿’ä¾†äº†è§£å§ï¼`,true);
      successAllSound.currentTime=0;
      successAllSound.play();
    }
  }

  payZone.innerHTML='';
  currentSum=0;
  updateSum();
}

/* ===== æç¤ºè¨Šæ¯è¦–çª— ===== */
function showMessage(text, cannotClose){
  const intro=document.getElementById('intro');
  const content=document.getElementById('slideContent');
  document.getElementById('prevBtn').style.display='none';
  document.getElementById('nextBtn').style.display='none';
  const btn=document.getElementById('startBtn');
  btn.style.display=cannotClose?'none':'block';
  btn.textContent='ç¹¼çºŒ';
  content.innerHTML=`<div class="slideContentLeft" style="font-size:22px;line-height:1.8;">${text}</div>`;  
  intro.style.display='flex';
  intro.style.zIndex=100;
  if(!cannotClose){
    btn.onclick=function(){
      btnClickSound.currentTime=0;
      btnClickSound.play();
      intro.style.display='none';
      renderSlide();
    }
  }
}

/* ===== æ­·å² ===== */
document.getElementById('historyBtn').onclick=function(){
  const modal=document.getElementById('modal');
  const content=document.getElementById('modalContent');
  content.innerHTML=`<h2>${PRICE}å…ƒ</h2>`;
  if(history.length===0){content.innerHTML+='<p>ç›®å‰é‚„æ²’æœ‰å®Œæˆéæ”¯ä»˜</p>';}
  else history.forEach((r,i)=>{
    const obj=JSON.parse(r);
    content.innerHTML+=`<div class="historyBlock">
      <div class="historyTitle">ç¬¬${i+1}ç¨®æ–¹å¼</div>
      <div class="historyCoins">${renderHistoryCoins(obj)}</div>
    </div>`;
  });
  modal.style.display='flex';
  modal.style.zIndex=100;
};
document.getElementById('modal').onclick=function(e){if(e.target.id==='modal')this.style.display='none';};

function renderHistoryCoins(obj){
  const order=[1000,100,10,1];
  let html='';
  order.forEach(v=>{
    if(obj[v]>0){
      html+=`<div class="coinWrapper">
        <div class="coin" data-value="${v}" style="cursor:default;">${v}</div>
        <div class="times">x${obj[v]}</div>
      </div>`;
    }
  });
  return html;
}
</script>
</body>
</html>
